<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 1700" preserveAspectRatio="xMidYMid meet">
  <defs>
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#f8fbff" />
      <stop offset="100%" stop-color="#e0e7ff" />
    </linearGradient>
    <filter id="cardShadow" x="-10%" y="-10%" width="140%" height="140%">
      <feDropShadow dx="0" dy="10" stdDeviation="14" flood-color="#1d4ed8" flood-opacity="0.16" />
    </filter>
    <marker id="arrowhead" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#1f2937" />
    </marker>
    <marker id="arrowhead-muted" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#475569" />
    </marker>
  </defs>

  <style>
    text { font-family: 'Inter', 'Segoe UI', Arial, sans-serif; fill: #0f172a; }
    .title { font-weight: 700; font-size: 40px; letter-spacing: 0.02em; }
    .subtitle { font-weight: 500; font-size: 20px; fill: #475569; }
    .badge { font-weight: 600; font-size: 14px; letter-spacing: 0.18em; text-transform: uppercase; fill: #2563eb; }
    .stage-title { font-weight: 700; font-size: 24px; }
    .stage-body { font-weight: 400; font-size: 18px; line-height: 1.6; fill: #1f2937; }
    .note { font-size: 16px; fill: #475569; }
    .stage-card { fill: #ffffff; stroke: rgba(37, 99, 235, 0.45); stroke-width: 2.2px; rx: 24; ry: 24; filter: url(#cardShadow); }
    .stage-card-alt { fill: #eef2ff; stroke: rgba(99, 102, 241, 0.55); stroke-width: 2.2px; rx: 24; ry: 24; filter: url(#cardShadow); }
    .callout-card { fill: #fef3c7; stroke: #f59e0b; stroke-width: 2.2px; rx: 24; ry: 24; filter: url(#cardShadow); }
    .callout-card-alt { fill: #cffafe; stroke: #0ea5e9; stroke-width: 2.2px; rx: 24; ry: 24; filter: url(#cardShadow); }
    .connector { stroke: #111827; stroke-width: 3px; fill: none; marker-end: url(#arrowhead); }
    .connector-muted { stroke: #475569; stroke-width: 2.6px; fill: none; stroke-dasharray: 12 10; marker-end: url(#arrowhead-muted); }
  </style>

  <rect x="0" y="0" width="1600" height="1700" fill="url(#bgGradient)" />

  <text x="800" y="110" text-anchor="middle" class="title">Tarana.ai Agentic Loop</text>
  <text x="800" y="152" text-anchor="middle" class="subtitle">Sense → Plan → Act → Reflect with context-aware tools</text>

  <!-- Stage cards -->
  <g id="stages">
    <rect x="440" y="200" width="720" height="190" class="stage-card-alt" />
    <text x="470" y="240" class="badge">Stage 1</text>
    <text x="470" y="278" class="stage-title">Goal &amp; Input</text>
    <text x="470" y="314" class="stage-body">
      <tspan x="470" dy="0">• Intake traveler prompt, preferences, and session metadata.</tspan>
      <tspan x="470" dy="28">• Establish desired itinerary scope and objectives.</tspan>
    </text>

    <rect x="440" y="430" width="720" height="200" class="stage-card" />
    <text x="470" y="472" class="badge">Stage 2</text>
    <text x="470" y="510" class="stage-title">Perception &amp; Validation</text>
    <text x="470" y="546" class="stage-body">
      <tspan x="470" dy="0">• Authenticate request, verify credit balance, and enforce schema (Zod).</tspan>
      <tspan x="470" dy="28">• Derive stable cache key plus retry budget before orchestration.</tspan>
    </text>

    <rect x="440" y="670" width="720" height="200" class="stage-card-alt" />
    <text x="470" y="712" class="badge">Stage 3</text>
    <text x="470" y="750" class="stage-title">World-State Acquisition</text>
    <text x="470" y="786" class="stage-body">
      <tspan x="470" dy="0">• Fetch live weather, traffic intelligence, and itinerary knowledge base.</tspan>
      <tspan x="470" dy="28">• Seed context for personalization, safety, and retrieval constraints.</tspan>
    </text>

    <rect x="440" y="910" width="720" height="200" class="stage-card" />
    <text x="470" y="952" class="badge">Stage 4</text>
    <text x="470" y="990" class="stage-title">Planning &amp; Decomposition</text>
    <text x="470" y="1026" class="stage-body">
      <tspan x="470" dy="0">• Score initial recall to detect coverage gaps or high-traffic conflicts.</tspan>
      <tspan x="470" dy="28">• Trigger agentic subqueries whenever candidate sets run thin.</tspan>
    </text>

    <rect x="440" y="1150" width="720" height="200" class="stage-card-alt" />
    <text x="470" y="1192" class="badge">Stage 5</text>
    <text x="470" y="1230" class="stage-title">Tool Execution &amp; Context Fusion</text>
    <text x="470" y="1266" class="stage-body">
      <tspan x="470" dy="0">• Run traffic-aware intelligent search, dedupe, and curate exclusive lists.</tspan>
      <tspan x="470" dy="28">• Assemble structured prompt with weather, budget, and group directives.</tspan>
    </text>

    <rect x="440" y="1390" width="720" height="200" class="stage-card" />
    <text x="470" y="1432" class="badge">Stage 6</text>
    <text x="470" y="1470" class="stage-title">Guaranteed Output &amp; Action</text>
    <text x="470" y="1506" class="stage-body">
      <tspan x="470" dy="0">• Invoke Guaranteed JSON Engine with retries and schema enforcement.</tspan>
      <tspan x="470" dy="28">• Consume credit, log metrics, and stream itinerary response.</tspan>
    </text>
  </g>

  <!-- Callouts -->
  <g id="callouts">
    <rect x="1210" y="980" width="320" height="240" class="callout-card-alt" />
    <text x="1238" y="1020" class="badge">Agent Assist</text>
    <text x="1238" y="1058" class="stage-title">Subquery Planner</text>
    <text x="1238" y="1094" class="stage-body">
      <tspan x="1238" dy="0">• Gemini proposes retrieval sub-goals tuned by peak hours and traffic.</tspan>
      <tspan x="1238" dy="30">• Expanded queries flow back into intelligent search orchestration.</tspan>
    </text>

    <rect x="70" y="1220" width="320" height="240" class="callout-card" />
    <text x="98" y="1260" class="badge">Reflection</text>
    <text x="98" y="1298" class="stage-title">Quality Gate</text>
    <text x="98" y="1334" class="stage-body">
      <tspan x="98" dy="0">• Validate JSON structure, activity constraints, and confidence signals.</tspan>
      <tspan x="98" dy="30">• If checks fail, fall back to planning loop for regeneration.</tspan>
    </text>
  </g>

  <!-- Connectors -->
  <g id="connectors">
    <path d="M800 390 L800 430" class="connector" />
    <path d="M800 630 L800 670" class="connector" />
    <path d="M800 870 L800 910" class="connector" />
    <path d="M800 1110 L800 1150" class="connector" />
    <path d="M800 1350 L800 1390" class="connector" />

    <path d="M800 1010 C1000 1010 1100 1010 1210 1010" class="connector" />
    <path d="M1210 1190 C1100 1190 1000 1190 800 1190" class="connector-muted" />
    <text x="1090" y="1140" class="note">Expanded retrieval plans rejoin Stage 5</text>

    <path d="M800 1580 C520 1580 400 1550 260 1470" class="connector-muted" marker-end="url(#arrowhead-muted)" />
    <path d="M230 1340 C230 1200 520 1185 800 1185" class="connector-muted" marker-end="url(#arrowhead-muted)" />
    <text x="360" y="1280" class="note">Schema or confidence issue → return to planning</text>
  </g>

  <text x="800" y="1660" text-anchor="middle" class="note">Each stage aligns Tarana.ai services to the canonical agentic lifecycle: observe, reason, act, and verify.</text>
</svg>
